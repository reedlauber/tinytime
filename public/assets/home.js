(function(a){a.Timer=function(d){var f=a.Component({id:"timer"},d);var c,j,r,n,p,q;function e(t){if(t.toString().length<2){return"0"+t}return t.toString()}function o(x,u,w){var v="";if(x){v+=e(x)+":"}if(u){v+=e(u)+":"}v+=e(w);return v}var b,m,i=0,k;function g(){m=new Date();b=setInterval(function(){var w=new Date()-m+i;w=Math.floor(w/1000);var v=Math.floor(w/(60*60));w-=(v*60*60);var t=Math.floor(w/60);w-=(t*60);var u=w;j.html(o(v,t,u))},500);k=true}function h(){clearInterval(b);i=new Date()-m+i;k=false}function s(){i=0;j.html("00")}function l(){n.click(function(){j.show();n.hide();p.show();q.show();c.addClass("active");s();g()});p.click(function(){if(k){h();p.text("Run")}else{g();p.text("Pause")}});q.click(function(){j.html('<span class="tt-timer-time-last">last</span> '+j.html());n.show();p.hide().text("Pause");q.hide();c.removeClass("active");h();$(a).trigger("timer-stopped",[Math.floor(i/1000)])})}f.oninit=function(){c=$('<div id="'+f.options.id+'" class="tt-timer tt-shadow tt-requireinstance" />').appendTo(f.options.target).append("<h5>Timer</h5>");j=$('<div class="tt-timer-time">00</div>').appendTo(c);r=$('<div class="tt-timer-btns" />').appendTo(c);n=$('<span class="btn success">Start</span>').appendTo(r);p=$('<span class="btn info">Pause</span>').appendTo(r).hide();q=$('<span class="btn danger">Stop</span>').appendTo(r).hide();l()};return f.pub}})(TinyTime);(function(a){a.Title=function(e){var c={},b=$.extend({id:"title",target:"#content"},e),d;var f,h;function g(j){var i=h.val();if(!i){i="Untitled"}if(i!=f.text()){a.Data.save("",{token:d.token,name:i},function(k){f.text(i);j();window.location.href="/"+d.username+"/"+k.slug+"/"+d.token},function(){j()})}else{j()}}c.init=function(i){d=i;f=$("#"+b.id+"-label",b.target);h=$("#"+b.id+"-input",b.target);f.click(function(){f.hide();h.show().focus()});h.blur(function(){g(function(){h.hide();f.show()})});return c};return c}})(TinyTime);(function(a){a.NewEntry=function(q){var l={},o=$.extend({id:"newentry",target:"#content",fields:[{id:"newentry-time",prop:"minutes",required:true},{id:"newentry-desc",prop:"desc",required:true,submit:true},{id:"newentry-tags",prop:"tags",submit:true}]},q),f;var m=/^[\d\.]+$/g,j=/^[0-9]{1,2}:[0-9]{2}$/,k=/[0-9\.]d/,d=/[0-9\.]h/,g=/[0-9\.]m/;function c(w){var t=0,u,s,r,v;if(m.test(w)){t=Math.floor(parseFloat(w))}else{if(j.test(w)){u=w.split(":");s=parseInt(u[0]);r=parseInt(u[1]);if(!$.isNaN(s)&&!$.isNaN(r)){t+=(s*60);t+=r}}else{u=w.split(" ");$.each(u,function(y,x){if(k.test(x)){v=parseFloat(x.replace("d",""));t+=(v*24*60)}else{if(d.test(x)){s=parseFloat(x.replace("h",""));t+=(s*60)}else{if(g.test(x)){r=Math.floor(parseFloat(x.replace("m","")));t+=r}}}})}}return t}function e(s){if(s.required){var r=!!$("#"+s.id).val();if(!r){$("#"+s.id).parent().addClass("error")}return r}return true}function b(){$("#"+o.id+"-time, #"+o.id+"-desc").val("");$("#newentry-workdate input").val($("#newentry-workdate").attr("data-date"));$("#"+o.fields[0].id).focus()}function n(){$(".error","#"+o.id).removeClass("error");var s=true,r={token:f.token,work_date:$("#newentry-workdate").attr("data-date")};$.each(o.fields,function(t,u){if(e(u)){r[u.prop]=$("#"+u.id).val()}else{s=false}});if(s){r.minutes=c(r.minutes);a.Data.save("/entries",r,function(t){b();$(a).trigger("entry-created",[t])})}}function h(){$.each(o.fields,function(r,s){if(s.submit){$("#"+s.id).keyup(function(t){if(t.which===13){$("#"+o.id+"-btn").click()}})}})}function p(t){var s=Date.parse(t),r={date:Date.today().toString(a.dateFormat),label:"Today"};if(s){s=s.clearTime();if(s<=Date.today()){r.date=s.toString(a.dateFormat);r.label=a.Util.recentDateLabel(s)}}return r}function i(){$("#"+o.id+"-btn").click(function(){try{n()}catch(s){a.log(s)}return false});var r=$(".tt-newentry-workdate-label").click(function(){$(this).hide();$("#newentry-workdate input").show()});$("#newentry-workdate input").blur(function(){var t=$(this).val();var s=p(t);if(s){r.html(s.label);$("#newentry-workdate").attr("data-date",s.date)}$(this).hide();r.show()});$(a).bind("timer-stopped",function(u,x){var w=Math.floor(x/(60*60));x-=w*60*60;var s=Math.round(x/60);var v="";if(w){v=w+"h"}if(s){v+=w?" ":"";v+=s+"m"}$("#"+o.fields[0].id).val(v);if(v){$("#"+o.fields[1].id).focus()}})}l.init=function(r){f=r;b();i();return l};return l}})(TinyTime);(function(a){a.Entries=function(d){var e={},m=$.extend({id:"entries",target:"#content"},d),s,f=[],k={},r=[],l=0,p=0;var b,o;var h=['<tr data-id="{{id}}">','<td class="tt-entry-time span3">{{time}}</td>','<td class="tt-entry-desc">','{{#tags}}<span class="label notice">{{tags}}</span>{{/tags}}',"{{description}}","</td>",'<td class="tt-entry-last">','{{#invoice_id}}<span class="label">Invoiced</span>{{/invoice_id}}','{{^invoice_id}}<a href="javascript:void(0)" class="tt-entry-del close">&times;</a>{{/invoice_id}}',"</td>","</tr>"].join("");var i=['<section class="tt-entry-group" data-date="{{work_date}}">',"<h2>{{label}}</h2>",'<table class="tt-entries-table zebra-striped">',"{{#entries}}",h,"{{/entries}}","</table>","<footer>{{total}}</footer>","</section>"].join("");function c(){var u=Date.today().toString(a.dateFormat);var t=[{work_date:u,entries:[]}];k[u]=0;$.each(r,function(w,x){var y,v;if(x.work_date in k){v=k[x.work_date];y=t[v]}else{v=t.length;k[x.work_date]=v;y={work_date:x.work_date,entries:[]};t.push(y)}y.entries.push(x)});return t}function g(){var t=a.Util.relativeTime(p);$(".tt-summary-time").html(t)}function j(){b.empty();p=0;l=0;$.each(f,function(u,v){v.minutes=0;$.each(v.entries,function(w,x){x.time=a.Util.relativeTime(x.minutes);v.minutes+=x.minutes;p+=x.minutes;if(!x.invoice_id){l+=x.minutes}});v.label=a.Util.recentDateLabel(v.work_date,true);v.total=a.Util.relativeTime(v.minutes);var t=a.template(i,v);b.append(t)});g()}function q(u,t,v){u.fadeOut(function(){u.remove();p-=t.minutes;g();var x=f[k[t.work_date]];var w=-1;$.each(x.entries,function(y,z){if(z.id===t.id){w=y;return false}});if(w>-1){x.entries.splice(w,1)}if(!x.entries.length&&x.label!=="Today"){$(".tt-entry-group[data-date="+x.work_date+"]").remove();f.splice(k[t.work_date]);k={};$.each(f,function(y,z){k[z.work_date]=y})}else{x.minutes-=t.minutes;x.total=a.Util.relativeTime(x.minutes);$(".tt-entry-group[data-date="+x.work_date+"] footer").html(x.total)}if(v>-1){r.splice(v,1)}})}function n(){$(".tt-entries-table").live("click",function(u){if($(u.target).hasClass("close")){var t=$(u.target).parents("tr");var x=parseInt(t.attr("data-id"),10);var v=-1;$.each(r,function(y,z){if(z.id===x){v=y;return false}});var w=r[v];if(w){a.Data.del("/entries/"+x,{token:s.token},function(y){if(y.success){q(t,w,v)}else{alert(y.message)}})}}});$(a).bind("entry-created",function(A,x){x.time=a.Util.relativeTime(x.minutes);p+=x.minutes;if(x.work_date in k){var z=f[k[x.work_date]];z.minutes+=x.minutes;z.total=a.Util.relativeTime(z.minutes);var y=$("section[data-date="+x.work_date+"]"),B=$("table",y),v=$("footer",y);var u=a.template(h,x);$(u).prependTo(B).hide().fadeIn();v.html(z.total)}else{k[x.work_date]=f.length;var w=a.Util.recentDateLabel(x.work_date,true);var z={work_date:x.work_date,entries:[x],label:w,minutes:x.minutes};z.total=a.Util.relativeTime(z.minutes);f.push(z);var t=a.template(i,z);b.append(t)}g();r.push(x)})}e.init=function(t){s=t;b=$("#"+m.id,m.target);o=$("#summary",m.target);a.Data.get("/entries",function(u){r=u;a.Util.groupEntries(r,function(v,w){f=v;k=w;j()},true)});n();return e};return e}})(TinyTime);