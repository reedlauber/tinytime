(function(a){a.Slider=function(m){var h={},j=$.extend({target:"body",steps:10},m);var l,b,d,c;var g=-4,k=100;function f(){var o=d.data("left")+4,n=c.data("left")-d.data("left");b.css({left:o,width:n})}function i(s,p,q){var o=s.data("left"),r=q===1?d.data("left"):g,n=q===0?c.data("left"):k;$("body").bind("mousemove",function(t){var v=t.pageX-p,u=o+v;if(u<r){u=r}if(u>n){u=n}s.data("left",u).css("left",u+"px");f()})}function e(){var n=false;d.bind("mousedown",function(o){n=true;i(d,o.pageX,0)});c.bind("mousedown",function(o){n=true;i(c,o.pageX,1)});$("body").bind("mouseup",function(){if(n){n=false;$("body").unbind("mousemove")}})}h.init=function(){l=$('<div class="tt-slider"><div class="tt-slider-bg" /></div>').appendTo(j.target);var n=l.width(),o=n/j.steps;k=n-6;b=$('<div class="tt-slider-bg-selected" />').appendTo(l);d=$('<span class="tt-slider-handle first" />').appendTo(l).data("left",-4).css("left",g);c=$('<span class="tt-slider-handle last" />').appendTo(l).data("left",k).css("left",k);e()};return h}})(TinyTime);(function(a){a.NewInvoice=function(){var i=a.Component({id:"newinvoice"}),h=a.Slider({target:"#"+i.options.id+"-range"}),d={all:0,range:0,entries:0},l={all:"",range:"",entries:""},c="all";var j,m;var g=['<div class="tt-newinvoice-total">Total <span>0h</span></div>',"<table>","{{#entries}}",'<tr data-minutes="{{minutes}}">','<td class="tt-entry-group span3">{{group}}</td>','<td class="tt-entry-choose span1"><input type="checkbox" /></td>','<td class="tt-entry-time span2">{{time}}</td>','<td class="tt-entry-desc">','{{#tags}}<span class="label notice">{{tags}}</span>{{/tags}}',"{{description}}","</td>","</tr>","{{/entries}}","</table>"].join("");function f(){var n=parseFloat($("#"+i.options.id+"-rate").val());if(n>0){var o=d[c]/60*n;$(".tt-newinvoice-price").html("$"+o.toFixed(2))}}function b(n){var q="",p=[],o=0;$.each(n,function(s,t){var r=a.Util.recentDateLabel(t.work_date);if(r!=q){q=r;t.group=q}o+=t.minutes;t.time=a.Util.relativeTime(t.minutes);p.push(t.id)});d.all=d.range=o;l.all=p.join(",");l.range=p.join(",");j.html(a.Util.relativeTime(o));f()}function k(n){m.html(a.template(g,{entries:n}));var o=0;$("tr",m).click(function(){var q=$(".tt-entry-choose input",this).attr("checked")==="checked";var p=parseInt($(this).attr("data-minutes"),0);if(q){$(".tt-entry-choose input",this).removeAttr("checked");o-=p}else{$(".tt-entry-choose input",this).attr("checked","checked");o+=p}$(this).toggleClass("selected")})}function e(){$(".tt-newinvoice-actions .btn.info").removeClass("disabled");$(".tt-newinvoice-actions .btn.success").removeClass("disabled");$(".tt-newinvoice-btns .btn").click(function(){if(!$(this).hasClass("disabled")){$(".tt-newinvoice-btns .info").removeClass("info");c=$(this).addClass("info").attr("rel");$(".tt-newinvoice-section").hide();$(".tt-newinvoice-section[rel="+c+"]").show()}});$("#"+i.options.id+"-create-btn").click(function(){if(!$(this).hasClass("disabled")){var n=parseFloat($("#"+i.options.id+"-rate:visible").val())||0;var o={title:Date.today().toString("yyyy-MM-dd"),rate:n,entries:l[c]};a.Data.save("/"+i.manager.token+"/invoices",o,function(q){var p="/"+i.manager.token+"/invoices/"+q.rank;window.open(p);window.location.href="/"+i.manager.token+"/edit"})}});$(".tt-newinvoice-summary-includerate").toggle(function(){$(".tt-newinvoice-summary-rate").show();$(this).text("Hide Rate");$("#"+i.options.id+"-rate").focus()},function(){$(".tt-newinvoice-summary-rate").hide();$(this).text("Include Rate")});$("#"+i.options.id+"-rate").keyup(function(){f()})}i.oninit=function(){j=$(".tt-newinvoice-total span");m=$("#"+i.options.id+"-entries");h.init();a.Data.get("/"+i.manager.token+"/entries?paid=false",function(n){if(n.length){b(n);k(n);e()}else{$(".tt-newinvoice-summary").hide();$("#"+i.options.id).append("There is no uninvoiced time for this timesheet.")}})};return i.pub}})(TinyTime);